<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body{
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        line-height: 2;
    }

    .container{
      margin: 100px auto;
      max-width: 960px;
    }

    select{
      font-size: large;
    }
</style>
<body>
  <div class = "container">
    <h1>Media Capabilities Test</h1>
    <form>
        <p>Select your video configuration and find out if this browser supports the codec, 
        and whether decoding will be smooth and power efficient:</p>
          <ul>
          <li>
            <label for="codec">Select a codec</label>
            <select id="codec">
              <option value = "video/webm;codecs=vp09.02.10.10.01.09.16.09.01">VP9</option>
              <option value = "video/mp4; codecs=avc1.420034">AVC/H.264</option>
              <option value = "video/mp4; codecs=hvc1.1.6.L93.B0" selected>HEVC/H.265</option>
            </select>
          </li>
          <li>
            <label for="size">Select a size</label>
            <select id="size">
              <option value="7680x4320">8K</option>
              <option value="3840x2160">4K UHD</option>
              <option value="2560x1440">1440p QHD</option>
              <option value="1920x1080"selected>1080p HD</option>
            </select>
          </li>
          <li>
            <label for="framerate">Select a framerate</label>
            <select id="framerate">
              <option>60</option>
              <option selected>30</option>
              <option>24</option>
            </select>
          </li>
            <li>
            <label for="bitrate">Select a bitrate</label>
            <select id="bitrate">
              <option selected>4000</option>
              <option>2500</option>
              <option>800</option>
            </select>
          </li>
          <li>
            <label for="HDR">Select a HDR config</label>
            <select id="HDRType">
              <option selected>pq</option>
              <option>hlg</option>
              <option>srgb</option>
              <option>x</option>
            </select>
            <select id="HDRMetaType">
              <option value = "smpteSt2094-10" selected>Dynamic (HDR10+/Dolby Vision)</option>
              <option value = "smpteSt2086" selected>Static (HDR10)</option>
            </select>
          </li>
          </ul>
          <p><input type="button" value="Test this Video Configuration" id="tryit"></p>
        </form> 
        
        <ul id="results"></ul>

      
    
</body>

<script>
    let mc = {
  videoConfiguration : new Object(),
  
  tryit: function () {
   mc.createConfiguration();
   mc.testit();
  },
    
  createConfiguration: function () {
    var size = document.getElementById('size').value.split('x');
    mc.videoConfiguration = {
      type: 'file',
      video: {
        contentType: document.getElementById('codec').value,
        width: size[0],
        height: size[1],
        bitrate: document.getElementById('bitrate').value,
        framerate: document.getElementById('framerate').value,
        TransferFunction: document.getElementById('HDRType').value
        
      }
    }
  },

  testit: function () {
    let content = '';
    navigator.mediaCapabilities.decodingInfo(mc.videoConfiguration).then(result => { 
      var li = document.createElement('li'),
        mcv = mc.videoConfiguration.video;
      content = 'A ' + mcv.width + 'x' + mcv.height + ', ' + mcv.contentType + ' in HDR' + ' at ' +
        mcv.framerate  + 'fps and ' +  mcv.bitrate + ' bps video ' +
        (result.supported ? ' IS ' : 'IS NOT ') + ' supported, ' +
        (result.smooth ? ' IS ' : ' is NOT ') + ' smooth, and' +
        (result.powerEfficient ? ' IS ' : ' IS NOT ') + 'power efficient.';
      var ul = document.getElementById("results")
      li.innerHTML = content;
      ul.appendChild(li);
    }).catch((error) => {
        var li = document.createElement('li'),
            ul = document.getElementById("results");
        li.innerText = 'Codec ' + mc.videoConfiguration.video.contentType + ' threw an error: ' + error;
        ul.appendChild(li);
    });
  }
}

// Detect if display is in HDR mode and if browser supports VP9 HDR.
function canPlayVp9Hdr() {
// TODO: Adjust VP9 codec string based on your video encoding properties.
return (window.matchMedia('(color-gamut: p3)').matches &&
    screen.colorDepth >= 48)
     //&& MediaSource.isTypeSupported('video/webm; codecs="vp09.02.10.10.01.09.16.09.01"'))
}


let detailInfo = '';
detailInfo = "Display color depth: " + screen.colorDepth + '<br>'
             + "Dolby Vision: " + MediaSource.isTypeSupported('video/mp4; codecs="dvhe"') + '<br>'
             + "HEVC Playback: " + MediaSource.isTypeSupported('video/mp4; codecs="hvc1"') + '<br>'
             + "Dolby Digital Plus Playback: " + MediaSource.isTypeSupported('video/mp4;codecs="ec-3"') + '<br>'
             + "YouTube 4K Support: " + MediaSource.isTypeSupported('video/webm; codecs="vp09.02.10.10.01.09.16.09.01"') + '<br>'
             

document.write('<h2>Additional Info </h2>' + '<h3> Device: ' + navigator.userAgent + '</h3>' + detailInfo + '</div>')


document.getElementById('tryit').addEventListener('click', mc.tryit);

</script>

</html>